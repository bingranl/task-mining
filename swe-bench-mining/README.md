# SWE-Bench Mining

This directory contains tools for mining Gradle-related pull requests from GitHub repositories and converting them into SWE-bench format for benchmarking and analysis.

## Overview

The mining pipeline extracts pull requests that contain Gradle build configuration changes from a list of Android/Kotlin repositories. The extracted data follows the SWE-bench format, making it suitable for software engineering benchmarking tasks.

## Files

### Scripts

#### `mine_gradle_prs.py`
Main mining script that extracts Gradle-related PRs from GitHub repositories.

**Features:**
- Searches for merged PRs containing Gradle file changes (`.gradle`, `.gradle.kts`, `gradle.properties`, etc.)
- Extracts PR metadata, commits, and patches
- Filters patches to include only Gradle-related changes
- Outputs data in SWE-bench format
- Supports concurrent processing with configurable worker threads
- Resumes from existing results (skips already processed repositories)

**Usage:**
```bash
python mine_gradle_prs.py [--repos REPOS_FILE] [--output OUTPUT_FILE] [--max-workers N]
```

**Arguments:**
- `--repos`: JSON file containing list of repositories (default: `dataset_repos.json`)
- `--output`: Output file for results (default: `gradle_prs_swe_bench.json`)
- `--max-workers`: Number of concurrent workers (default: 3)

**Requirements:**
- GitHub API token set in environment variable `GITHUB_TOKEN` or `.env` file

#### `trim_swe_bench.py`
Utility script to create a trimmed dataset with one PR per repository.

**Purpose:**
- Reduces dataset size for testing or sampling
- Keeps only the first PR instance from each unique repository

**Usage:**
```bash
python trim_swe_bench.py
```

**Input:** `gradle_prs_swe_bench.json`  
**Output:** `gradle_prs_swe_bench_trimmed.json`

### Data Files

#### `dataset_repos.json`
Input file containing a list of GitHub repositories to mine.

**Format:**
```json
[
  "owner/repo1",
  "owner/repo2",
  ...
]
```

**Content:** 48 Android/Kotlin open-source repositories

#### `gradle_prs_swe_bench.json`
Main output file containing all mined PRs in SWE-bench format.

**Format:** Array of PR instances, each containing:
- `instance_id`: Unique identifier (format: `owner__repo-pr_number`)
- `repo`: Repository name (`owner/repo`)
- `issue_id`: PR number
- `base_commit`: Base commit SHA before the PR
- `problem_statement`: PR title/description
- `version`: Version string (default: "1.0.0")
- `issue_url`: Issue URL (empty if not applicable)
- `pr_url`: Pull request URL
- `patch`: Full diff of Gradle-related changes
- `test_patch`: Test-related patches (currently empty)
- `created_at`: PR creation timestamp
- `FAIL_TO_PASS`: Array of tests that should pass after fix (currently empty)
- `PASS_TO_PASS`: Array of tests that should continue passing (currently empty)

#### `gradle_prs_swe_bench_trimmed.json`
Trimmed dataset with one PR per repository (generated by `trim_swe_bench.py`).

## Workflow

1. **Prepare repository list**: Create or update `dataset_repos.json` with target repositories
2. **Set up authentication**: Configure `GITHUB_TOKEN` in environment or `.env` file
3. **Run mining**: Execute `mine_gradle_prs.py` to extract PRs
4. **Optional trimming**: Run `trim_swe_bench.py` to create a smaller sample dataset

## Example

```bash
# Set GitHub token
export GITHUB_TOKEN="your_github_token"

# Mine all repositories (uses defaults)
python mine_gradle_prs.py

# Mine with custom settings
python mine_gradle_prs.py --repos my_repos.json --output my_results.json --max-workers 5

# Create trimmed dataset
python trim_swe_bench.py
```

## Notes

- The mining process is resumable: if interrupted, it will skip already processed repositories on restart
- Rate limiting: GitHub API has rate limits; adjust `--max-workers` if you encounter issues
- The script only extracts merged PRs to ensure the changes were accepted
- Patches are filtered to include only Gradle-related file changes
